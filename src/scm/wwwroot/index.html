<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width" />
        <meta charset="utf-8" />

        <title>Simple Contact Manager</title>

        <!-- API -->
        <script>
            function CreateThingApi(thing) {
                return fetch("api/things", {
                    method: "post",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(thing),
                });
            }

            function GetThingsApi(processThings) {
                return fetch("api/things")
                    .then((response) => response.json())
                    .then((things) => processThings(things));
            }

            function DeleteThingApi(thing) {
                return fetch("api/things", {
                    method: "delete",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(thing),
                });
            }
        </script>

        <!-- HTML Formatting -->
        <script>
            LoadThings();

            function CreateThing() {
                let left_input = GetLeftInput();
                let right_input = GetRightInput();

                CreateThingApi({
                    left: left_input.value,
                    right: right_input.value,
                }).then(LoadThings());

                left_input.value = "";
                right_input.value = "";
            }

            function LoadThings() {
                GetThingsApi(PopulateThingsTable);
            }

            function DeleteThing(thing) {
                DeleteThingApi(thing).then(LoadThings());
            }

            function DeleteThingButton(thing) {
                return "<input type='button' value='Delete' onclick='DeleteThing(".concat(
                    JSON.stringify(thing),
                    ")' />"
                );
            }

            function PopulateThingsTable(things) {
                let thingsHTML = "";

                things.forEach((thing) => {
                    thingsHTML = thingsHTML.concat(
                        "<tr><td>",
                        thing.left,
                        "</td><td>",
                        thing.right,
                        "</td><td>",
                        DeleteThingButton(thing),
                        "</td></tr>"
                    );
                });

                GetThingsTableElement().innerHTML = thingsHTML;
            }

            function GetThingsTableElement() {
                return document.getElementById("things_table");
            }

            function GetLeftInput() {
                return document.getElementById("left_input");
            }
            function GetRightInput() {
                return document.getElementById("right_input");
            }
        </script>
    </head>

    <body>
        <h1>Simple Contact Manager</h1>

        <form action="javascript:CreateThing()">
            <h2>Create Thing</h2>
            <label for="left_input">Left:</label><br />
            <input type="text" id="left_input" name="Left" /><br />
            <label for="right_input">Right:</label><br />
            <input type="text" id="right_input" name="Right" /><br /><br />
            <input type="submit" value="Create Thing" />
        </form>

        <h2>Old Things</h2>
        <table>
            <thead>
                <th>Left Side</th>
                <th>Right Side</th>
            </thead>
            <tbody id="things_table">
                <!-- Filled dynamically -->
            </tbody>
        </table>
    </body>
</html>
